var currentCountry, pulledCountry = localStorage.getItem("storedCountry"); pulledCountry && (currentCountry = pulledCountry); var submitBtn = document.querySelector("#submit"), countrySpan = document.querySelector("#country-name"), dateSpan = document.querySelector("#date"), resetBtn = document.querySelector("#reset"), startBtn = document.querySelector("#start"), modal = document.querySelector("#page-modal"), close = document.querySelector(".modal-close"); function fetchAll() { fetch("https://covid-19-data.p.rapidapi.com/totals", { method: "GET", headers: { "x-rapidapi-key": "8ccd2e1920msh3d1d6843984bb49p112bfejsn6cb44c98c1ec", "x-rapidapi-host": "covid-19-data.p.rapidapi.com" } }).then(function (e) { return e.json() }).then(function (e) { const n = e[0].confirmed, t = e[0].recovered, r = e[0].critical, o = e[0].deaths; document.querySelector("#confirmed-number").innerHTML = n.toLocaleString("en-US"), document.querySelector("#recovered-number").innerHTML = t.toLocaleString("en-US"), document.querySelector("#critical-number").innerHTML = r.toLocaleString("en-US"), document.querySelector("#deaths-number").innerHTML = o.toLocaleString("en-US"); var c = moment(e[0].lastUpdate).format("DD MMMM YYYY"); dateSpan.innerHTML = c, console.log(e[0]) }).catch(e => { console.log("error no country found"), countrySpan.innerHTML = "(No country found)", document.querySelector("#confirmed-number").innerHTML = "-", document.querySelector("#recovered-number").innerHTML = "-", document.querySelector("#critical-number").innerHTML = "-", document.querySelector("#deaths-number").innerHTML = "-" }) } function fetchData() { fetch("https://covid-19-data.p.rapidapi.com/country?name=" + currentCountry, { method: "GET", headers: { "x-rapidapi-key": "8ccd2e1920msh3d1d6843984bb49p112bfejsn6cb44c98c1ec", "x-rapidapi-host": "covid-19-data.p.rapidapi.com" } }).then(function (e) { return e.json() }).then(function (e) { console.log(e), console.log(e); const n = e[0].confirmed, t = e[0].recovered, r = e[0].critical, o = e[0].deaths; var c = moment(e[0].lastUpdate).format("DD MMMM YYYY"); console.log(c), document.querySelector("#confirmed-number").innerHTML = n.toLocaleString("en-US"), document.querySelector("#recovered-number").innerHTML = t.toLocaleString("en-US"), document.querySelector("#critical-number").innerHTML = r.toLocaleString("en-US"), document.querySelector("#deaths-number").innerHTML = o.toLocaleString("en-US"), dateSpan.innerHTML = c, console.log(e[0]), localStorage.setItem("storedCountry", e[0].country) }).catch(e => { console.log("error no country found"), countrySpan.innerHTML = "(No country found)", document.querySelector("#confirmed-number").innerHTML = "-", document.querySelector("#recovered-number").innerHTML = "-", document.querySelector("#critical-number").innerHTML = "-", document.querySelector("#deaths-number").innerHTML = "-" }) } function updateData() { currentCountry = document.querySelector("#input").value, countrySpan.innerHTML = currentCountry, fetchData() } function init() { currentCountry ? (fetchData(), countrySpan.innerHTML = currentCountry) : fetchAll() } startBtn.onclick = function () { modal.style.display = "block" }, close.onclick = function () { modal.style.display = "none" }, window.onclick = function (e) { console.log("i have clicked the grey part"), console.log(e.target.className), "modal-background is-clipped" == e.target.className && (modal.style.display = "none") }, submitBtn.addEventListener("click", function (e) { e.preventDefault(), updateData(), modal.style.display = "none" }), resetBtn.addEventListener("click", function (e) { e.preventDefault(), fetchAll(), countrySpan.innerHTML = "all countries", localStorage.clear() }), init();